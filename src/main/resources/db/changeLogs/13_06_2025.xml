<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">


    <changeSet id="drop-image-and-add-product-images-sql" author="your_name">
        <sql>
            ALTER TABLE products DROP COLUMN IF EXISTS image_id;
            ALTER TABLE categories DROP COLUMN IF EXISTS image_id;
            ALTER TABLE subcategory DROP COLUMN IF EXISTS image_id;

            CREATE TABLE IF NOT EXISTS product_images (
                                                          product_id BIGINT NOT NULL,
                                                          image_id BIGINT NOT NULL,
                                                          PRIMARY KEY (product_id, image_id)
                );

            ALTER TABLE product_images
                ADD CONSTRAINT fk_product_images_product
                    FOREIGN KEY (product_id)
                        REFERENCES products (id)
                        ON DELETE CASCADE;

            ALTER TABLE product_images
                ADD CONSTRAINT fk_product_images_file
                    FOREIGN KEY (image_id)
                        REFERENCES files (id)
                        ON DELETE CASCADE;
        </sql>
    </changeSet>

    <changeSet id="drop-category-image-and-add-category-images-sql" author="your_name">
        <sql>
            ALTER TABLE categories DROP COLUMN IF EXISTS image;

            CREATE TABLE IF NOT EXISTS category_images (
                                                           category_id BIGINT NOT NULL,
                                                           image_id BIGINT NOT NULL,
                                                           PRIMARY KEY (category_id, image_id)
                );

            ALTER TABLE category_images
                ADD CONSTRAINT fk_category_images_category
                    FOREIGN KEY (category_id)
                        REFERENCES categories (id)
                        ON DELETE CASCADE;

            ALTER TABLE category_images
                ADD CONSTRAINT fk_category_images_file
                    FOREIGN KEY (image_id)
                        REFERENCES files (id)
                        ON DELETE CASCADE;
        </sql>
    </changeSet>



</databaseChangeLog>